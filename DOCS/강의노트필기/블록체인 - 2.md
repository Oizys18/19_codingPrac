# 블록체인 - 2

- 고덕윤 교수님


## 1) 이더리움 소개

- Vitalik Buterin이 제안한 공개형 블록체인
- 분산 어플리케이션을 위한 플랫폼을 표방
- 스마트 컨트랙트가 핵심요소
- Ether, 이더 : 이더리움에서 발행한 암호화폐

### 분산화된 상태전이 머신

- 트랜잭션에 기반한 상태전이
  - 이전 상태로 돌아갈 수 없음
- 암호화 알고리즘을 활용 : 무작위로 상태전이가 일어나는 것을 방지
- 모든 참여자가 동일한 상태를 공유
- 블록은 해당 시점의 이더리움의 상태를 나타낸다.

### 중요 구성요소

#### 1) 계정

- 외부 소유 계정 EOA
  - 컨트랙트 코드를 가지고 있지 않음
  - 개인 키를 통한 주소 관리 
- 컨트랙트 계정 CA 
  - 컨트랙트 코드 보유
  - 주소 O 개인키 X 
  - 거래나 메시지를 수신하면 보유하고 있는 컨트랙트 코드를 실행 

#### 2) 주소

- 개인키 생성 : 256bit 무작위 숫자 -> 64자리 Hex 값 인코딩
- 타원곡선전자서명 알고리즘 (ECDSA, secp256k1)을 사용하여 공개키 생성
- Keccak-256 hashing : 마지막 20byte가 계정주소 
- 계정 주소 

#### 3) 상태

- 어느 한 시점의 Ether의 잔액, 계정들의 집합
- 모든 이더리움의 참여 노드는 로컬에 상태 정보를 유지
- stateObject
  - 상태 수정이 발생한 이더리움 계정을 나타내는 객체
  - 이더리움의 state DB인 levelDB에 업데이트 

#### 4) 상태전이 state transaction

- 블록 채굴로 인한 거래 내역 추가 시 상태 전이 발생 
- 계정 간 거래 

#### 5) 트랜잭션 종류

- EOA to CA 
  - CA to EOA
  - CA to CA
- EOA to EOA 

#### 6) Transaction Recipt

- 트랜잭션의 실행결과 기록 
- 검색을 위한 인덱스, 해당 트랜잭션이 포함된 블록의 번호 및 해쉬 등 저장

#### 7) 블록 

- 이더리움 장부에 기록되는 데이터의 기본 단위
- 트랜잭션들의 집합

#### 8) 작업 증명 PoW

- Ethash
  - 비트코인의 PoW의 문제점(낮은 ASIC 저항성)을 개선 - ASIC(Application Specific Integrated Circuit)
  - 계산은 어렵게, 검증은 쉽게 

#### 9) 지분증명 PoS (Proof of state)

- 검증자가 가진 지분에 비례한 확률로 블록 생성 권한을 획득하고 원하는 체인에 연결, 보상 획득
- PoW의 문제점 (전력 소모량, 채굴중앙화) 개선
- 이더리움은 Casper를 통해 PoS로 전환 중 

#### 10) Casper FFG (Friendly Finality Gadget)

- PoW + PoS의 하이브리드 방식 
- 1~99번째 블록은 PoW, 100번째 블록은 PoS로 채굴

### 스마트 컨트랙트

- 개발언어 
  - Solidity : 현재 가장 많이 사용되고 있는 이더리움 스마트 컨트랙트 언어
  - SERPENT : 초창기 이더리움의 스마트 컨트랙트 언어 
  - LLL : 어셈블리 언어와 유사 
- 가스 GAS
  - 이더리움을 움직이게 하는 기본단위
  - 트랜잭션, 스마트 컨트랙트를 위한 수수료 
    - 무분별한 실행을 통한 과부하 방지도 가능
  - 가스 가격의 기본 단위 : Gwei(1Gwei == 0.000000001 ETH)
  - 사용자가 정의 가능하고, 가스 가격을 높이 주면 더 빨리 처리 가능 

## 2) 이더리움 가상 머신

- 이더리움 스마트 컨트랙트를 실행하기 위한 가상머신
- 특징
  - 튜링 완전 머신, 스택 기반 구조, 32byte 메모리
  - 이더리움 주소 연산(160bit), 256 bit 암호화 알고리즘 등 이더리움 관련 구조 연산에 적합
- 모든 동작을 수행하기 위해서는 사전에 가스가 지불되어야 함
  - DDoS 공격을 방지하기 위함
- 결정적 머신 : 항상 동일한 상태를 반환
- 스택 기반 동작
  - 입력값 -> bytecode
  - 입력값 종류에 따라 다른 동작 수행 

## 3) 솔리디티 개요

- 이더리움 스마트 컨트랙트 언어의 종류
  - 가장 많이 활용되는 언어
  - Java와 유사한 문법
- 특징
  - 객체지향 언어
    - Class ~ Contract
    - Object instance ~ EVM에 배포된 스마트 컨트랙트
  - 정적 타입 언어
    - 다음 노드의 주소를 저장하는 자료구조
  - 스택 기반으로 동작하는 EVM 상에서 구동 