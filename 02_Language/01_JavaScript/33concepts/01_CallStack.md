# 01_CallStack

- https://velog.io/@jakeseo_me/2019-03-15-2303-%EC%9E%91%EC%84%B1%EB%90%A8-rmjta5a3xh
- original source of this posting is from https://medium.com/@gaurav.pandvia/understanding-javascript-function-executions-tasks-event-loop-call-stack-more-part-1-5683dea1f5ec If the original author requests deletion, it will be deleted immediately.

- Translated by Jake Seo (서진규)

  - https://velog.io/@jakeseo_me
  - https://github.com/n00nietzsche

## 함수 실행에 대한 이해

- 자바스크립트는 `하나의 스레드`로 단 `1개의 동시성`만 다루는 언어
  - 한 번에 1개의 작업만 다룰 수 있다.
  - JS의 `Heap` `Queue` `Stack` -> 크롬의 `V8` 내부에 구현되어 있다.

### 1. 콜스택 CallStack

- 함수의 호출을 기록하는 자료구조
- 우리가 프로그램 안에서 위치한 곳
- 함수 실행 시 스택에 `push` 된다.
- 함수로부터 반환 받을 때, 스택에서 `pop` 된다.

### 2. 힙 Heap

- 오브젝트(객체)들은 `힙` 내부에 할당
- 거의 구조화되지 않은 영역(unstructured)의 메모리
- 변수와 객체들의 모든 메모리 할당이 여기서 일어남.
-

### 3. 큐 Queue

- 자바스크립트 런타임은 `메시지 큐`를 갖고 있다.
- `메세지 큐`
  - 실행될 콜백함수나 실행될 메세지들에 대한 리스트
- 스택이 충분한 공간(capacity)를 갖고 있을 때, 메세지는 큐 밖으로 나오고 메세지가 가지고 있던 함수 목록들이 실행된다. -> `초기 스택 프레임`
- 스택이 다시 빌 때 메세지 수행도 끝난다.
- 이벤트들에 대한 콜백 함수가 제공되었다면 메세지들은 외부 비동기 이벤트들에 대한 응답으로 큐에 쌓인다.
- 외부 비동기 이벤트들이란 마우스 클릭, HTTP 요청 등을 말합니다. 하지만 만일 한 사용자가 버튼을 눌렀는데 아무런 콜백함수도 등록되어 있지 않다면 어떠한 메시지도 큐에 들어가지 않을 것입니다.
- 메시지들은 웹 브라우저에서 언제든 이벤트가 발생했을 때 추가된다. 

### 4. 이벤트 루프 Event Loop

- 싱글 스레드 언어인 자바스크립트는 스택에 쌓인 함수들에서 어떠한 값을 반환하기 전까지는 즉각적인 반응을 보여줄 수 없다. 즉 즉각적인 반응이 필요할 때 스택이 막혀있다면 아무런 반응을 볼 수가 없다.
- 따라서 싱글 스레드인 자바스크립트에서 유동적인 UI를 만들기 위해 비동기함수를 사용한다.
- 비동기 콜백 == 코드의 일정 부분을 실행시키고 나중에 실행될 콜백함수를 스택에 넣는 것 (AJAX)
- 모든 비동기 콜백들은 코드에서 읽힌 순간 실행되지 않고, 잠시 후에 실행된다.
  - == 동기 함수들과는 다르게 바로 스택 내부로 push되지 않는다.

- 이벤트 루프가 하는 일?
  - 이벤트 루프는 큐에서 콜백을 실행하고 스택이 비어있을때 스택에 넣는다. 이벤트 루프의 기본 작업은 스택과 작업 큐를 모두 보고 스택이 비어있을때 큐의 첫번째 작업을 스택에 넣는 것이다. 각 메시지 또는 콜백은 다른 메시지가 처리되기 전에 완전히 처리된다.

- 콜백 함수의 호출은 호출 스택의 초기 프레임으로 사용되며 JavaScript가 단일 스레드이므로 스택의 모든 호출이 반환 될 때까지 추가 메시지 폴링 및 처리가 중단됩니다. 후속 (동기식) 함수 호출은 스택에 새로운 호출 프레임을 추가합니다.

  - `폴링`
  - 통신에서, "폴링"은 한 프로그램이나 장치에서 다른 프로그램이나 장치들이 어떤 상태에 있는지를 지속적으로 체크하는 전송제어 방식으로서, 대체로 그들이 아직도 접속되어 있는 지와 데이터 전송을 원하는지 등을 확인한다.